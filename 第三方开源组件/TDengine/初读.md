# 首次学习随笔

## 一、表

### 1、超级表(STable)和普通表

超级表是指某一特定类型的数据采集点的集合。同一类型的数据采集点，其表的结构是完全一样的，但每个表（数据采集点）的静态属性（标签）是不一样的。描述一个超级表（某一特定类型的数据采集点的集合），除需要定义采集量的表结构之外，还需要定义其标签的 schema，标签的数据类型可以是整数、浮点数、字符串，标签可以有多个，可以事后增加、删除或修改。如果整个系统有 N 个不同类型的数据采集点，就需要建立 N 个超级表。
在 TDengine 的设计里，<font color=red}>表用来代表一个具体的数据采集点，超级表用来代表一组相同类型的数据采集点集合。</font>当为某个具体数据采集点创建表时，用户使用超级表的定义做模板，同时指定该具体采集点（表）的标签值。与传统的关系型数据库相比，表（一个数据采集点）是带有静态标签的，而且这些标签可以事后增加、删除、修改。<font color=red>一张超级表包含有多张表，这些表具有相同的时序数据 schema，但带有不同的标签值。</font>

超级表的数据是其各个子表的集合。数据插入仅在子表进行。

### 2、表的创建

#### 超级表

```sql
CREATE STABLE meters (ts timestamp, current float, voltage int, phase float) TAGS (location binary(64), groupId int);
```

| 字段           | 说明             |
| -------------- | ---------------- |
| meters         | 表名             |
| ts, float, int | 数据类型，关键字 |

超级表创建的时候，要定义好采集数据字段、标签名字。采集数据字段中必须要有时间戳，且时间戳必须是第一列。
从这里可以看出，一条数据是可以存储多个监控指标值的。

#### 普通表

```sql
CREATE TABLE d1001 USING meters TAGS ("Beijing.Chaoyang", 2);
```

普通表创建时要指定其从属于哪个超级表。同时要对照超级表定义好 tags 的值。

### 3、使用场景

涛斯这个东西，一开始就是为物联网服务的，其数据结构是适应于工业生产。
每一个超级表，对应一类监控对象；每一张普通表，定义了这一类下的某一具体个体。
例如：

1. 超级表对应电表；普通表对应某处的一块电表；普通表里存着这一具体的电表的所有数据(电压、电流、相位)
2. 超级表对应 redis；普通表对应某一台 redis；普通表里存着这一台 redis 的所有监控数据(内存、连接数、碎片率等等)

这个场景下，就要求对于监控数据的结构，要提前设计。不能像以前那样，只要 tag 定义好，数据直接存。现在要做分层。当然，如果就是只存一个数据，就和之前 opentsdb 一样。

### 4、表的边界

1. 数据库名最大长度为 32。
2. 表名最大长度为 192，每行数据最大长度 16k 个字符, 从 2.1.7.0 版本开始，每行数据最大长度 48k 个字符（注意：数据行内每个 BINARY/NCHAR 类型的列还会额外占用 2 个字节的存储位置）。
3. 列名最大长度为 64，最多允许 1024 列，最少需要 2 列，第一列必须是时间戳。（从 2.1.7.0 版本开始，改为最多允许 4096 列）
4. 标签名最大长度为 64，最多允许 128 个，可以 1 个，一个表中标签值的总长度不超过 16k 个字符。
5. SQL 语句最大长度 1048576 个字符，也可通过系统配置参数 maxSQLLength 修改，取值范围 65480 ~ 1048576。
6. SELECT 语句的查询结果，最多允许返回 1024 列（语句中的函数调用可能也会占用一些列空间），超限时需要显式指定较少的返回数据列，以避免语句执行报错。（从 2.1.7.0 版本开始，改为最多允许 4096 列）
7. 库的数目，超级表的数目、表的数目，系统不做限制，仅受系统资源限制。

### 5、字段名称合法性限制

1. TDengine 中的表（列）名命名规则如下： 只能由字母、数字、下划线构成，数字不能在首位，长度不能超过 192 字节，不区分大小写。

2. 转义后表（列）名规则： 为了兼容支持更多形式的表（列）名，TDengine 引入新的转义符 "\`"。可用让表名与关键词不冲突，同时不受限于上述表名称合法性约束检查。 转义后的表（列）名同样受到长度限制要求，且长度计算的时候不计算转义符。使用转义字符以后，不再对转义字符中的内容进行大小写统一。
   例如： \`aBc\` 和 \`abc\` 是不同的表（列）名，但是 abc 和 aBc 是相同的表（列）名。
   需要注意的是转义字符中的内容必须是可打印字符。

3. 支持版本
   支持转义符的功能从 2.3.0.1 版本开始。

## 二、部署

有现成的部署脚本，本身极为轻量，安装很快。
第一个节点一路回车就行
