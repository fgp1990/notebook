### 王宁的统计body_size的需求
查询语句
{"size":0,"query":{"bool":{"must":[{"match_phrase":{"api.keyword":{"query":"/api/sideBar"}}},{"range":{"timestamp":{"gte":1629884100000,"lte":1629884700000,"format":"epoch_millis"}}},{"match_phrase":{"statuscode":{"query":200}}}]}},"aggs":{"result":{"date_histogram":{"field":"timestamp","interval":"10s","time_zone":"Asia/Shanghai","min_doc_count":0},"aggs":{"need_value":{"range":{"field":"body_bytes_sent","ranges":[{"from":0,"to":400}],"keyed":true}}}}}}

### 9-8:
1、上个月做的告警接受组件，因为上线后使用线上kafka出现严重丢数据问题。消费者大概率不消费消息。把kafka部分去掉了，改为直接转发。
本来还想搞个redis做缓冲，有点麻烦。暂时不做了。
转发的时候，做了简单的白名单校验
2、明天要把接口统计的fmp部分做出来。
需要新增的字段今天已经在model里面加好。
明天把sql写出来；把前端做好，增删改查、条件搜索这些。
有时间的话，把后端统计的框架写出来。
后天测一测。

### 9-9：
1、该干的都没干
2、接口计算有个bug，没有对访问ES异常的情况做处理，给加上了
3、告警接收改了路由架构。
1. main只有接口，具体接口的处理提取成单独文件，方便定义返回码
2. 增加推送falcon的逻辑

4、接口部分，把表的名字都改小写了。线上都是小写，且mysql不区分大小写。但是测试环境区分，改成统一的了。明天makemigration，一定有问题，大小写这部分要跳过，恐怕得一步一步自己执行了

### 9-10：
1、数据库字段加好了
2、前端搜索优化。搜索可选条件更多，并把搜索框改为弹出。
3、前端该增加的字段跟着数据库字段增加也做好了

### 9-13：
1、api_calculate把计算逻辑做出来
2、计算逻辑没有做，光写设计了。还有很多问题没有想好

### 9-14：
1、王宁统计bodysize分布的功能做完了，明天再跑看看，确实有问题。且逻辑混乱，需要重新调整

### 9-15：
1、改颜文的bug
ES表里面有的url是错的；有的在采集的时候就没有采集到；接口过滤的正则范围太大，把一些业务请求也给过滤掉了
2、把王宁要的bodysize统计功能重新整理了一下，有些地方是按照离线计算写的，实际是按照实时计算写的，全统一成实时计算。当然也可以搞成离线，看情况吧
3、明天要把fmp的前端和对应的后端搞好，特别是数据库的部分。
4、明天最好拉着王鹏把设计过了，不然不踏实

### 9-16：
1、把api_calculate的数据对了一遍，基本准确。这个就算结束了
2、和王鹏把clickhouse的设计对完
3、clickhouse查询语句写好，测完
4、clickhouse前端数据库model写好，明天弄上，填好数据。就可以开发前端了
5、明天要把前端搞完，照着es的做，应该很快

### 9-17：
1、简单看了下api_calculate的数，基本正确
2、fmp上后端数据库和增删改查做完
3、前端把机房、click house表相关的都做完
4、接口把接口的编辑和搜索页做完。
5、下午去机房帮财务盘点去了
6、明天把接口列表页做完
7、还有历史记录页，小流量接口页，这两个简单点

### 9-18
1、忘了干啥了。反正是接口计算那部分
2、应该是按namespace统计做完了

### 9-22：
1、个人发展规划表
2、接口计算基本完成
3、明天把域名表完善一下，计算就完成了。接着可以算一次，把历史记录、小流量表做完

### 9-23
1、新做了个关键业务配置页面，用来单独设置务必统计的业务
2、后台统计新增接口的逻辑做了一半
3、明天用今天做的接口把需要的信息拉下来，然后继续写逻辑

### 9-24
1、上午去办房产证
2、fmp调整model，去掉了机房的外键关系，没有用
3、fmp增加小流量接口的增删改查搜
4、计算部分改到get_interfaces最后6行了。

### 9-25
1、值班
2、统计需要做删除接口
明天要验证一下，delete怎么实现，印象是知道id直接删除。目前不知道id，只能通过条件过滤，然后删除

### 9-26
1、后台刷新接口信息，已完成
2、做了一点流量统计
3、明天把流量统计做完，就开始测试

### 9-27
1、开始测试
2、fmp前后端已经上线，还是有bug。还行，没有出现逻辑问题，就是有些字段应该删掉，漏删了。非设计问题
3、计算部分，判定是否小流量接口的地方，还没有完成。需要搞完。但不影响结果，还是有逻辑错误

### 9-28
1、开始测试，数据更新基本完成。明天把restful接口配一下，就可以开始走全量
2、前端需要把翻页做一下，接口页的翻页
INSERT INTO ckh_allapi (create_time, update_time, memo, `status`, api, restime_low, restime_middle, restime_high, bodysize_flag, body_small, body_large, `fixed`, restful_flag, smallflow_flag, last_collect_time, ckh_table_id) VALUES (NOW(), NOW(),"",0,"apiii",0.5,1,5,0,400,20000,1,1,0,0,"aaaa")

### 9-30
1、统计全部做完，开始稳定性测试
2、body_size计算，只能算1个小时的，不对劲